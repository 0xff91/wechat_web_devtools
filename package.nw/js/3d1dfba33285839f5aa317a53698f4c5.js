'use strict';!function(require,directRequire){function a(a){const b=i.createHash('md5');return b.update(a).digest('hex')}async function b(a){return new Promise(async(b,c)=>{try{const c=await o({taskName:'processJS',config:{projectPath:a.projectPath,file:a.file,es6:a.es6?'yes':'no',minified:a.minified?'yes':'no',sourceMaps:'map',sourceFileName:a.file},dataStr:a.code,maxTimeout:180000,useBackup:!0,downgrade:!1,onAfterRun:a.onAfterRun,forceBackup:r});b(c)}catch(a){a instanceof Error?c(a):c(new Error(a))}})}async function c(c,g={}){return new Promise(async(h,i)=>{x[c.hash||'']||(x[c.hash||'']={});const j=x[c.hash||''],{es6:k,minified:m,newFeature:n}=c.setting,{srcFilePath:o,fileBuffer:q,destFilePath:r,destPath:u,fileName:v,onAfterRun:w,projectPath:y,filesIgnored:z}=g;let A=s(q),B='';if(void 0===A){const a=new Error(l.config.FILE_NOT_UTF8.format(o));return a.code=t,i(a)}const C=Date.now(),D=a(A),E=`${o}_${k}_${m}`;if(j[E]&&j[E].md5===D)(k||m)&&512000<=A.length&&(z||[]).push(v),A=j[E].jsCode,B=j[E].map,console.log('compile js',v,'in cache, skip.');else{if((k||m)&&512000>A.length){const a=await b({projectPath:y,file:v,es6:k,minified:m,sourceFileName:v,code:A,onAfterRun:w});if(console.log(`process ${v} cost time: ${Date.now()-C}`),a.error){const b=a.error,c=new Error(b.message||b);return c.code=b.code,i(c)}A=a.code,B=a.map}else(k||m)&&512000<=A.length&&(z||[]).push(v),B=await p(e.join(y,v),A);try{'string'==typeof B&&(B=JSON.parse(B)),B=await p.insertSourcesContent(B,e.join(y,v)),B=JSON.stringify(B)}catch(a){B=null}j[E]={md5:D,jsCode:A,map:B}}const F=e.dirname(r);if(f.sync(F),B){const a=e.join(u,`${v}.map`);d.writeFileSync(a,B)}d.writeFileSync(r,A),h()})}const d=require('fs'),e=require('path'),f=require('mkdir-p'),g=require('babel-core'),h=require('uglify-js'),i=require('crypto'),j=require('babel-code-frame'),k=require('./162bf2ee28b76d3b3d95b685cede4146.js'),l=require('./common/locales/index.js'),m=require('./9fdd4ac31a05c27355910f0d74accd4c.js'),n=require('./a63026ab5a5a3c59a61a9749a18aa2ca.js'),o=require('./41168dca39589e852da6631126d0f94d.js'),p=require('./cdbf7243dc99f8461acbb1d57af1d8ae.js'),q=require('./2e9637e8a0816a626f7db9a0dee5efe8.js'),r=!1,{bufToUTF8:s}=require('./efc820e1b92d6e4063535296d4a24213.js'),{FILE_NOT_UTF8:t,BABEL_TRANS_JS_ERR:u,UGLIFY_JS_ERR:v,BABILI_JS_ERR:w}=require('./949d8235c744ced2a80121e4dba34c28.js'),x={};module.exports=async function(a,b={}){const d=a.compileType,{distPath:f,onProgressUpdate:g,onFilesIgnored:h}=b;let j=await k(a),o=j.getAllJSFiles(),p=d==m.plugin?a.miniprogramRoot:'';const q=[],r=[];let i=[...o],s=(a)=>{const b=i.findIndex((b)=>b===a);0<=b&&i.splice(b,1),i[0]&&g('compilejs',l.config.PROCESSING.format(i[0]))};for(let d=0,g=o.length;d<g;d++){const b=o[d],g=j.getFile(b,null);r.push(c(a,{projectPath:j.srcPath,srcFilePath:e.join(p,b),destFilePath:e.join(f,p,b),destPath:e.join(f,p),fileBuffer:g,fileName:b,onAfterRun:s.bind(null,b),filesIgnored:q}))}const t=Date.now();if(await Promise.all(r),d==m.plugin){j=await n(a),o=j.getAllJSFiles(),p=a.pluginRoot;const b=[];i=[...o],s=(a)=>{const b=i.findIndex((b)=>b===a);0<=b&&i.splice(b,1),i[0]&&g('compilejs',l.config.PROCESSING.format(i[0]))};for(let d=0,g=o.length;d<g;d++){const g=o[d],h=j.getFile(g,null);b.push(c(a,{projectPath:j.srcPath,srcFilePath:e.join(p,g),destFilePath:e.join(f,p,g),destPath:e.join(f,p),fileBuffer:h,fileName:g,onAfterRun:s.bind(null,g),filesIgnored:q}))}await Promise.all(b)}console.log('compile all js cost time',Date.now()-t),h(q)}}(require('lazyload'),require);